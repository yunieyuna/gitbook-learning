# 3. Normative Finance

## Chapter 3. Normative Finance

> The CAPM is based on many unrealistic assumptions. For example, the assumption that investors care only about the mean and variance of one-period portfolio returns is extreme.
>
> Eugene Fama and Kenneth French (2004)

> \[S]ciences that involve human beings rather than elementary particles have proven more resistant to elegant mathematics.
>
> Alon Halevy et al. (2009)

This chapter reviews major normative financial theories and models. Simply speaking and for the purposes of this book, a _normative theory_ is one that is based on assumptions (mathematically, axioms) and derives insights, results, and more from the set of relevant assumptions. On the other hand, a _positive theory_ is one that is based on observation, experiments, data, relationships, and the like and describes phenomena given the insights gained from the available information and the derived results. Rubinstein (2006) provides a detailed historical account of the origins of the theories and models presented in this chapter.

[“Uncertainty and Risk”](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#uncertainty\_risk) introduces central notions from financial modeling, such as uncertainty, risk, traded assets, and so on. [“Expected Utility Theory”](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#eu\_theory) discusses the major economic paradigm for decision making under uncertainty: _expected utility theory_ (EUT). In its modern form, EUT dates back to von Neumann and Morgenstern (1944). [“Mean-Variance Portfolio Theory”](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#mvp\_theory) introduces the mean-variance portfolio (MVP) theory according to Markowitz (1952). [“Capital Asset Pricing Model”](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#cap\_model) analyzes the _capital asset pricing model_ (CAPM) according to Sharpe (1964) and Lintner (1965). [“Arbitrage Pricing Theory”](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#ap\_theory) sketches the _arbitrage pricing theory_ (APT) according to Ross (1971, 1976).

This chapter’s purpose is to set the stage for the rest of the book in the form of central normative financial theories. This is important because generations of economists, financial analysts, asset managers, traders, bankers, accountants, and others have been trained in these theories. In that sense, it is safe to say that finance as both a theoretical and practical discipline has been shaped by these theories to a large extent.

## Uncertainty and Risk

At its core, financial theory deals with investment, trading, and valuation in the presence of uncertainty and risk. This section introduces on a somewhat formal level central notions related to these topics. The focus is on fundamental concepts from probability theory that build the backbone of quantitative finance.[1](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#idm46320010302616)

### Definitions

Assume an economy for which activity is only observed at two points in time: today, �=0, and one year later, �=1. The financial theories discussed later in this chapter are to a large extent based on such a _static economy_.[2](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#idm46320010293832)

At �=0, there is no uncertainty whatsoever. At �=1, the economy can take on a finite number � of possible states �∈�={�1,�2,...,��}. � is called the _state space_, and it holds |�|=� for its cardinality.

An _algebra_ ℱ in � is a family of sets with the following:

1. �∈ℱ
2. 𝔼∈ℱ⇒𝔼�∈ℱ
3. 𝔼1,𝔼2,...,𝔼�∈ℱ⇒∪�=1�𝔼�∈ℱ

𝔼� denotes the complement of a set 𝔼. The power set ℘(�) is the largest algebra, while the set ℱ={∅,�} is the smallest algebra in �. An algebra is a model for _observable events_ in an economy. In this context, a single state of the economy �∈� can be interpreted as an _atomic event_.

A _probability_ assigns a real number 0≤��≡�({�})≤1 to a state �∈� or a real number 0≤�(𝔼)≤1 to an event 𝔼∈ℱ. If the probabilities for all states are known, it holds �(𝔼)=∑�∈𝔼��.

A _probability measure_ �:ℱ→\[0,1] is characterized by the following:

1. ∀𝔼∈ℱ:�(𝔼)≥0
2. �∪�=1�𝔼�=∑�=1�𝔼�fordisjointsets𝔼�∈ℱ
3. �(�)=1

Together the three elements {�,ℱ,�} form a _probability space_. A probability space is the formal representation for _uncertainty_ in the model economy. If the probability measure � is fixed, the economy is said to be under _risk_. If it is known to all agents in the economy, the economy is said to have _symmetric information_.

Given a probability space {�,ℱ,�}, a _random variable_ is a function �:�→ℝ+,�↦�(�) that is ℱ-measurable. This implies that for each 𝔼∈{\[�,�\[:�,�∈ℝ,�<�} one has the following:

�-1(𝔼)≡{�∈�:�(�)∈𝔼}∈ℱ

If ℱ≡℘(�), the _expectation_ of a random variable is defined by the following:

𝐄�(�)=∑�∈��(�)·�(�)

Otherwise, it is defined by:

𝐄�(�)=∑𝔼∈ℱ�(𝔼)·�(𝔼)

In general, it is assumed that a financial economy is _perfect_. This means, among other things, that there are no transaction costs, available assets have fixed prices and are available in infinite quantities, everything happens at the speed of light, and agents have complete, symmetric information.

### Numerical Example

Assume now a simple _static_ economy under _risk_ {�,ℱ,�} for which the following holds:

1. �≡{�,�}
2. ℱ≡℘(�)
3. �≡{�({�})=12,�({�})=12}

#### Traded assets

In the economy, two assets are traded. The first is a risky asset, the _stock_, with a certain price today of �0=10 and an uncertain payoff tomorrow in the form of the random variable:

�1=�1�=20if�=��1�=5if�=�

The second is a risk-less asset, the _bond_, with a certain price today of �0=10 and a certain payoff tomorrow of the following:

�1=�1�=11if�=��1�=11if�=�

Formally, the model economy can then be written as ℳ2=({�,ℱ,�},𝔸), where 𝔸 represents the tradable assets in the form of the price vector �0=(�0,�0)� today and the market payoff matrix tomorrow of the following:

�1=�1��1��1��1�

#### Arbitrage pricing

In such an economy, one can, for example, address the problem of deriving the fair value of a _European call option_ on the stock with a strike price of �= 14.5. The arbitrage-free value of the European call option �0 is derived by replicating the option’s payoff �1 through a portfolio � of the stock and the bond. The price of the replicating portfolio must also be the price of the European call option. Otherwise, (infinite) arbitrage profits would be possible. In Python, making use of such a replication argument, this is easily accomplished:[3](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#idm46320010543544)

```
In [1]: import numpy as np

In [2]: S0 = 10  
        B0 = 10  

In [3]: S1 = np.array((20, 5))  
        B1 = np.array((11, 11))  

In [4]: M0 = np.array((S0, B0)) 
        M0  
Out[4]: array([10, 10])

In [5]: M1 = np.array((S1, B1)).T  
        M1  
Out[5]: array([[20, 11],
               [ 5, 11]])

In [6]: K = 14.5  

In [7]: C1 = np.maximum(S1 - K, 0) 
        C1  
Out[7]: array([5.5, 0. ])

In [8]: phi = np.linalg.solve(M1, C1)  
        phi  
Out[8]: array([ 0.36666667, -0.16666667])

In [9]: np.allclose(C1, np.dot(M1, phi))  
Out[9]: True

In [10]: C0 = np.dot(M0, phi)  
         C0  
Out[10]: 2.0
```

[![1](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/1.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO1-1)

The prices of the stock and bond today.

[![2](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/2.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO1-3)

The uncertain payoff of the stock and bond tomorrow.

[![3](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/3.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO1-5)

The market price vector.

[![4](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/4.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO1-7)

The market payoff matrix.

[![5](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/5.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO1-9)

The strike price of the option.

[![6](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/6.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO1-10)

The uncertain payoff of the option.

[![7](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/7.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO1-12)

The replication portfolio �.

[![8](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/8.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO1-14)

A check whether its payoff is the same as the option’s payoff.

[![9](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/9.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO1-15)

The price of the replication portfolio is the arbitrage-free price of the option.

## ARBITRAGE PRICING

Arbitrage pricing theory, as illustrated in the preceding example, can be considered one of the strongest financial theories with some of the most robust mathematical results, such as the _fundamental theorem of asset pricing (FTAP)_.[4](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#idm46320009535112) Among other reasons, this is due to the fact that prices of options, for example, can be derived from other observable market parameters, say, the share price of the stock on which the option is written. Arbitrage pricing in that sense does not take care of how to come up with a fair share price in the first place, but simply takes it as an input. Therefore, arbitrage pricing works already with few and mild assumptions, such as _absence of arbitrage_, which cannot be said of many other financial theories. Note that not even the probability measure is used to derive the arbitrage price.

## Expected Utility Theory

Expected utility theory (EUT) is a cornerstone of financial theory. Since its formulation in the 1940s, it has been one of the central paradigms for modeling decision making under uncertainty.[5](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#idm46320009425448) Basically every introductory textbook about financial theory and the theory of investments provides an account of EUT. One of the reasons is that other central results in finance can be derived from the EUT paradigm.

### Assumptions and Results

EUT is an axiomatic theory, dating back to the seminal work of von Neumann and Morgenstern (1944). _Axiomatic_ here means that major results of the theory can be deduced from a small number of axioms only. For a survey of axiomatic utility theory, different variants, and applications, see Fishburn (1968).

#### Axioms and normative theory

On [Wolfram MathWorld](https://oreil.ly/pZqal), you find the following definition for _axiom_: “An axiom is a proposition regarded as self-evidently true without proof.”

EUT is generally based on a small set of major axioms with regard to the _preferences_ of an agent when faced with choice under uncertainty. Although the definition of axiom suggests otherwise, not all of the axioms are regarded as “self-evidently true without proof” by all economists.

Von Neumann and Morgenstern (1944, p. 25) comment on the choice of axioms:

> A choice of axioms is not a purely objective task. It is usually expected to achieve some definite aim—some specific theorem or theorems are to be derivable from the axioms—and to this extent the problem is exact and objective. But beyond this there are always other important desiderata of a less exact nature: The axioms should not be too numerous, their system is to be as simple and transparent as possible, and each axiom should have an immediate intuitive meaning by which its appropriateness may be judged directly.

In that sense, a set of axioms constitutes a _normative theory_ of (the parts of) the world to be modeled by the theory. The set of axioms collects the minimum set of assumptions that should be satisfied a priori and not through some formal proof or similar. Before listing a set of axioms that leads to EUT, here are some words about the preferences of an agent themselves, formally ⪰, when presented with choice under uncertainty.

#### Preferences of an agent

Assume an agent with preferences ⪰ is faced with the problem of investing in the two traded assets of the model economy ℳ2. For example, the agent might have the option to choose between portfolio �� leading to a future payoff �=��·�1 or portfolio �� leading to a future payoff �=��·�1. The agent’s preferences ⪰ are assumed to be defined over the future payoffs and not over the portfolios. If the agent (strongly) prefers payoff � over �, one writes �≻� and �≺� in the other case. If the agent is indifferent to the two payoffs, one writes �∼�. Given these descriptions, one possible set of axioms leading to EUT is as follows:

Completeness

The agent can rank _all_ payoffs relative to one another. One of the following must hold true: �≻�, �≺�, or �∼�.

Transitivity

If there is a third portfolio �� with future payoff �=��·�1, it follows from �≻� and �≻� that �≻�.

Continuity

If �≻�≻�, then there exists a number �∈\[0,1] such that �∼��+(1-�)�.

Independence

From �∼� it follows that ��+(1-�)�∼��+(1-�)�. Similarly, from �≻� it follows that ��+(1-�)�≻��+(1-�)�.

Dominance

If �1=�1�+(1-�1)� and �2=�2�+(1-�2)�, it follows from �≻� and �1≻�2 that �1>�2.

#### Utility functions

A _utility function_ is a way to represent the preferences ⪰ of an agent in a mathematical and numerical way in that such a function assigns a numerical value to a certain payoff. In this context, the absolute value is not relevant. It is rather the ordering that the values induce that is of interest.[6](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#idm46320009276408) Assume that 𝕏 represents all possible payoffs over which the agent can express her preferences. A utility function � is then defined as follows:

�:𝕏→ℝ+,�↦�(�)

If � represents the preferences ⪰ of an agent, then the following relationships hold true:

�≻�⇒�(�)>�(�)(stronglyprefers)�⪰�⇒�(�)≥�(�)(weaklyprefers)�≺�⇒�(�)<�(�)(stronglydoesnotprefer)�⪯�⇒�(�)≤�(�)(weaklydoesnotprefer)�∼�⇒�(�)=�(�)(isindifferent)

A utility function � is only determined up to a positive linear transformation. Therefore, if � represents the preferences ⪰, then �=�+�� with �,�>0 does so as well. Regarding utility functions, von Neumann and Morgenstern (1944, p. 25) summarize as follows: “So we see: If such a numerical valuation of utilities exists at all, then it is determined up to a linear transformation. I.e. then utility is a number up to a linear transformation.”

#### Expected utility functions

Von Neumann and Morgenstern (1944) show that if the preferences of an agent ⪰ satisfy the preceding five axioms, then there exists an _expected utility function_ of the form:

�:𝕏→ℝ+,�↦𝐄�(�(�))=∑���(�)�(�(�))

Here, �:ℝ→ℝ,�↦�(�) is a monotonically increasing, state-independent function, often called _Bernoulli utility_, such as �(�)=ln(�),�(�)=�, or �(�)=�2.

In words, the expected utility function � first applies a function � to the payoff �(�) in a certain state and then uses the probabilities for a given state to occur �(�) to weigh the single utilities. In the special case of linear Bernoulli utility �(�)=�, the expected utility is simply the expected value of the state-dependent payoff, �(�)=𝐄�(�).

#### Risk aversion

In finance, the concept of _risk aversion_ is important. The most commonly used measure of risk aversion is the Arrow-Pratt measure of _absolute risk aversion_ (ARA), which dates back to Pratt (1964). Assume that an agent’s state-independent Bernoulli utility function is �(�). Then the Arrow-Pratt measure of ARA is defined by the following:

���(�)=-�''(�)�'(�),�≥0

The following three cases can be distinguished according to this measure:

���(�)=-�''(�)�'(�)>0risk-averse=0risk-neutral<0risk-loving

In financial theories and models, risk aversion and risk neutrality in general are assumed to be appropriate cases. In gambling, risk-loving agents probably can be found as well.

Consider the three Bernoulli functions previously mentioned: �(�)=ln(�),�(�)=�, or �(�)=�2. It is easily verified that they model risk-averse, risk-neutral, and risk-loving agents, respectively. Consider, for example, �(�)=�2:

\-�''(�)�'(�)=-22�<0,�>0⇒risk-loving

### Numerical Example

The application of EUT is easily illustrated in Python. Assume the example model economy from the previous section ℳ2. Assume that an agent with preferences ⪰ decides according to the EUT between different future payoffs. The Bernoulli utility of the agent is given by �(�)=�. In the example, payoff �1 resulting from portfolio �� is preferred over the payoff �1 resulting from portfolio ��.

The following code illustrates this application:

```
In [11]: def u(x):
             return np.sqrt(x)  

In [12]: phi_A = np.array((0.75, 0.25))  
         phi_D = np.array((0.25, 0.75))  

In [13]: np.dot(M0, phi_A) == np.dot(M0, phi_D)  
Out[13]: True

In [14]: A1 = np.dot(M1, phi_A)  
         A1  
Out[14]: array([17.75,  6.5 ])

In [15]: D1 = np.dot(M1, phi_D)  
         D1  
Out[15]: array([13.25,  9.5 ])

In [16]: P = np.array((0.5, 0.5))  

In [17]: def EUT(x):
             return np.dot(P, u(x))  

In [18]: EUT(A1)  
Out[18]: 3.381292321692286

In [19]: EUT(D1)  
Out[19]: 3.3611309730623735
```

[![1](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/1.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO2-1)

The risk-averse Bernoulli utility function

[![2](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/2.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO2-2)

Two portfolios with different weights

[![3](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/3.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO2-4)

Shows that the cost to set up each portfolio is the same

[![4](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/4.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO2-5)

The uncertain payoff of one portfolio…

[![5](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/5.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO2-7)

…and the other one

[![6](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/6.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO2-9)

The probability measure

[![7](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/7.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO2-10)

The expected utility function

[![8](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/8.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO2-11)

The utility values for the two uncertain payoffs

A typical problem in this context is to derive an optimal portfolio (that is, one that maximizes the expected utility) given a fixed budget of the agent �>0. The following Python code models this problem and solves it exactly. Of its available budget, the agent puts roughly 60% in the risky asset and roughly 40% in the risk-less asset. The results are mainly driven by the particular form of the Bernoulli utility function:

```
In [20]: from scipy.optimize import minimize

In [21]: w = 10  

In [22]: cons = {'type': 'eq', 'fun': lambda phi: np.dot(M0, phi) - w}  

In [23]: def EUT_(phi):
             x = np.dot(M1, phi)  
             return EUT(x)  

In [24]: opt = minimize(lambda phi: -EUT_(phi),  
                        x0=phi_A,  
                        constraints=cons)  

In [25]: opt  
Out[25]:      fun: -3.385015999493397
              jac: array([-1.69249132, -1.69253424])
          message: 'Optimization terminated successfully.'
             nfev: 16
              nit: 4
             njev: 4
           status: 0
          success: True
                x: array([0.61122474, 0.38877526])

In [26]: EUT_(opt['x'])  
Out[26]: 3.385015999493397
```

[![1](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/1.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO3-1)

The fixed budget of the agent

[![2](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/2.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO3-2)

The budget constraint for use with `minimize`[7](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#idm46320008384616)

[![3](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/3.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO3-3)

The expected utility function defined over portfolios

[![4](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/4.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO3-5)

Minimizing `-EUT_(phi)` maximizes `EUT_(phi)`

[![5](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/5.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO3-6)

The initial guess for the optimization

[![6](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/6.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO3-7)

The budget constraint applied

[![7](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/7.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO3-8)

The optimal results, including the optimal portfolio under `x`

[![8](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/8.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO3-9)

The optimal (highest) expected utility given the budget of �=10

## Mean-Variance Portfolio Theory

Mean-variance portfolio (MVP) theory, according to Markowitz (1952), is another cornerstone in financial theory. It is one of the first theories of investment under uncertainty that focused on statistical measures only for the construction of stock investment portfolios. MVP completely abstracts from, say, fundamentals of a company that might drive its stock performance or assumptions about the future competitiveness of a company that might be important for the growth prospects of a company. Basically, the only input data that counts is the time series of share prices and statistics derived therefrom, such as the (historical) annualized mean return and the (historical) annualized variance of the returns.

### Assumptions and Results

The central assumption of MVP, according to Markowitz (1952), is that investors _only_ care about expected returns and the variance of these returns:

> We next consider the rule that the investor does (or should) consider expected return a desirable thing and variance of return an undesirable thing. This rule has many sound points, both as a maxim for, and hypothesis about, investment behavior.
>
> The portfolio with maximum expected return is not necessarily the one with minimum variance. There is a rate at which the investor can gain expected return by taking on variance, or reduce variance by giving up expected return.

This approach to investors’ preferences is quite different to the approach that defines an agent’s preferences and utility function over payoffs directly. MVP rather assumes that an agent’s preferences and utility function can be defined over the first and second moment of the returns an investment portfolio is expected to yield.

## IMPLICITLY ASSUMED NORMAL DISTRIBUTION

In general, MVP theory, focusing on one period portfolio risk and return only, is not compatible with standard EUT. One way of resolving this issue is to assume that returns of risky assets are normally distributed such that the first and second moments are sufficient to describe the full distribution of an asset’s returns. This is something almost never observed in real financial data, as the next chapter illustrates. The other way is to assume a particular quadratic Bernoulli utility function, as shown in the next section.

#### Portfolio statistics

Assume a static economy ℳ�=({�,ℱ,�},𝔸), for which the set of tradable assets 𝔸 consists of � risky assets, �1,�2,...,��. With �0� being the fixed price of asset � today and �1� being its payoff in one year, the (simple) net returns vector �� of asset � is defined by the following:

��=�1��0�-1

For all future states having the same probability to unfold, the _expected return_ of asset � is given by:

��=1|�|∑����(�)

Accordingly, the _vector of expected returns_ is given by the following:

�=�1�2⋮��

A _portfolio_ (vector) �=�1,�2,...,���, with ��≥0 and ∑����=1, assigns weights to each asset in the portfolio.[8](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#idm46320008324824)

The _expected return of the portfolio_ is then given by the dot product of the portfolio weights vector and the vector of expected returns:

��ℎ�=�·�

Now define the _covariance_ between assets � and � by the following:

���=∑����(�)-����(�)-��

The _covariance matrix_ then is given by:

�=�11�12...�1��21�22...�2�⋮⋮⋱⋮��1��2...���

The _expected variance of the portfolio_ is then in turn given by the double dot product:

��ℎ�=��·�·�

The _expected volatility of the portfolio_ accordingly is the following:

��ℎ�=��ℎ�

#### Sharpe ratio

Sharpe (1966) introduces a measure to judge the risk-adjusted performance of mutual funds and other portfolios, or even single risky assets. In its simplest form, it relates the (expected, realized) return of a portfolio to its (expected, realized) volatility. Formally, the _Sharpe ratio_ therefore can be defined by the following:

��ℎ�=��ℎ���ℎ�

If � represents the risk-less short rate, the _risk premium_ or _excess return_ of a portfolio �ℎ� over a risk-free alternative is defined by ��ℎ�-�. In another version of the Sharpe ratio, this risk premium is the numerator:

��ℎ�=��ℎ�-���ℎ�

If the risk-less short rate is relatively low, the two versions do not yield too different numerical results if the same risk-less short rate is applied. In particular, when ranking different portfolios according to the Sharpe ratio, the two versions should generate the same ranking order, everything else equal.

### Numerical Example

Getting back to the static model economy ℳ2, the basic notions of MVP can again be easily illustrated by the use of Python.

#### Portfolio statistics

First, here is the derivation of the portfolio _expected return_:

```
In [27]: rS = S1 / S0 - 1  
         rS  
Out[27]: array([ 1. , -0.5])

In [28]: rB = B1 / B0 - 1  
         rB  
Out[28]: array([0.1, 0.1])

In [29]: def mu(rX):
             return np.dot(P, rX)  

In [30]: mu(rS)  
Out[30]: 0.25

In [31]: mu(rB)  
Out[31]: 0.10000000000000009

In [32]: rM = M1 / M0 - 1  
         rM  
Out[32]: array([[ 1. ,  0.1],
                [-0.5,  0.1]])

In [33]: mu(rM)  
Out[33]: array([0.25, 0.1 ])
```

[![1](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/1.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO4-1)

Return vector of the risky asset

[![2](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/2.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO4-3)

Return vector of the risk-less asset

[![3](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/3.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO4-5)

Expected return function

[![4](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/4.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO4-6)

Expected returns of the traded assets

[![5](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/5.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO4-8)

Return matrix for the traded assets

[![6](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/6.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO4-10)

Expected return vector

Second, the _variance_ and _volatility_, as well as the _covariance matrix_:

```
In [34]: def var(rX):
             return ((rX - mu(rX)) ** 2).mean()  

In [35]: var(rS)
Out[35]: 0.5625

In [36]: var(rB)
Out[36]: 0.0

In [37]: def sigma(rX):
             return np.sqrt(var(rX))  

In [38]: sigma(rS)
Out[38]: 0.75

In [39]: sigma(rB)
Out[39]: 0.0

In [40]: np.cov(rM.T, aweights=P, ddof=0)  
Out[40]: array([[0.5625, 0.    ],
                [0.    , 0.    ]])
```

[![1](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/1.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO5-1)

The variance function

[![2](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/2.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO5-2)

The volatility function

[![3](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/3.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO5-3)

The covariance matrix

Third, the _portfolio expected return_, _portfolio expected variance_, and _portfolio expected volatility_, illustrated for an equally weighted portfolio:

```
In [41]: phi = np.array((0.5, 0.5))

In [42]: def mu_phi(phi):
             return np.dot(phi, mu(rM))  

In [43]: mu_phi(phi)
Out[43]: 0.17500000000000004

In [44]: def var_phi(phi):
             cv = np.cov(rM.T, aweights=P, ddof=0)
             return np.dot(phi, np.dot(cv, phi))  

In [45]: var_phi(phi)
Out[45]: 0.140625

In [46]: def sigma_phi(phi):
             return var_phi(phi) ** 0.5  

In [47]: sigma_phi(phi)
Out[47]: 0.375
```

[![1](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/1.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO6-1)

The portfolio expected return

[![2](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/2.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO6-2)

The portfolio expected variance

[![3](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/3.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO6-3)

The portfolio expected volatility

#### Investment opportunity set

Based on a Monte Carlo simulation for the portfolio weights �, one can visualize the investment opportunity set in the volatility-return space ([Figure 3-1](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#figure\_nf\_01), generated by the following code snippet).

<figure><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/aiif_0301.png" alt="aiif 0301" height="1492" width="2510"><figcaption></figcaption></figure>

**Figure 3-1. Simulated expected portfolio volatility and return (one risky asset)**

Because there is only one risky asset and one risk-less asset, the opportunity set is a straight line:

```
In [48]: from pylab import plt, mpl
         plt.style.use('seaborn')
         mpl.rcParams['savefig.dpi'] = 300
         mpl.rcParams['font.family'] = 'serif'

In [49]: phi_mcs = np.random.random((2, 200))  

In [50]: phi_mcs = (phi_mcs / phi_mcs.sum(axis=0)).T  

In [51]: mcs = np.array([(sigma_phi(phi), mu_phi(phi))
                         for phi in phi_mcs])  

In [52]: plt.figure(figsize=(10, 6))
         plt.plot(mcs[:, 0], mcs[:, 1], 'ro')
         plt.xlabel('expected volatility')
         plt.ylabel('expected return');
```

[![1](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/1.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO7-1)

Random portfolio compositions, normalized to 1

[![2](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/2.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO7-3)

Expected portfolio volatility and return for the random compositions

Consider now the case of a static three-state economy ℳ3 for which �={�,�,�} holds. The three states are equally likely, �=13,13,13. The set of tradable assets consists of two risky assets � and � with a fixed price of �0=�0=10 and uncertain payoffs, respectively, of the following:

�1=20105

and

�1=11213

Based on these assumptions, the following Python code repeats the Monte Carlo simulation and visualizes the results in [Figure 3-2](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#figure\_nf\_02). With two risky assets, the well-known MVP “bullet” becomes visible.

```
In [53]: P = np.ones(3) / 3  
         P  
Out[53]: array([0.33333333, 0.33333333, 0.33333333])

In [54]: S1 = np.array((20, 10, 5))

In [55]: T0 = 10
         T1 = np.array((1, 12, 13))

In [56]: M0 = np.array((S0, T0))
         M0
Out[56]: array([10, 10])

In [57]: M1 = np.array((S1, T1)).T
         M1
Out[57]: array([[20,  1],
                [10, 12],
                [ 5, 13]])

In [58]: rM = M1 / M0 - 1
         rM
Out[58]: array([[ 1. , -0.9],
                [ 0. ,  0.2],
                [-0.5,  0.3]])

In [59]: mcs = np.array([(sigma_phi(phi), mu_phi(phi))
                         for phi in phi_mcs])

In [60]: plt.figure(figsize=(10, 6))
         plt.plot(mcs[:, 0], mcs[:, 1], 'ro')
         plt.xlabel('expected volatility')
         plt.ylabel('expected return');
```

[![1](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/1.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO8-1)

New probability measure for three states

<figure><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/aiif_0302.png" alt="aiif 0302" height="1492" width="2545"><figcaption></figcaption></figure>

**Figure 3-2. Simulated expected portfolio volatility and return (two risky assets)**

#### Minimum volatility and maximum Sharpe ratio

Next, the derivation of the _minimum volatility_ (minimum variance) and _maximum Sharpe ratio_ portfolios. [Figure 3-3](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#figure\_nf\_03) shows the location of the two portfolios in the risk-return space.

Although the risky asset � has a negative expected return, it has a significant weight in the maximum Sharpe ratio portfolio. This is due to diversification effects that lower the portfolio risk more than the expected return of the portfolio is reduced:

```
In [61]: cons = {'type': 'eq', 'fun': lambda phi: np.sum(phi) - 1}

In [62]: bnds = ((0, 1), (0, 1))

In [63]: min_var = minimize(sigma_phi, (0.5, 0.5),
                            constraints=cons, bounds=bnds)  

In [64]: min_var
Out[64]:      fun: 0.07481322946910632
              jac: array([0.07426564, 0.07528945])
          message: 'Optimization terminated successfully.'
             nfev: 17
              nit: 4
             njev: 4
           status: 0
          success: True
                x: array([0.46511697, 0.53488303])

In [65]: def sharpe(phi):
             return mu_phi(phi) / sigma_phi(phi)  

In [66]: max_sharpe = minimize(lambda phi: -sharpe(phi), (0.5, 0.5),
                        constraints=cons, bounds=bnds)  

In [67]: max_sharpe
Out[67]:      fun: -0.2721654098971811
              jac: array([ 0.00012054, -0.00024174])
          message: 'Optimization terminated successfully.'
             nfev: 38
              nit: 9
             njev: 9
           status: 0
          success: True
                x: array([0.66731116, 0.33268884])

In [68]: plt.figure(figsize=(10, 6))
         plt.plot(mcs[:, 0], mcs[:, 1], 'ro', ms=5)
         plt.plot(sigma_phi(min_var['x']), mu_phi(min_var['x']),
                  '^', ms=12.5, label='minimum volatility')
         plt.plot(sigma_phi(max_sharpe['x']), mu_phi(max_sharpe['x']),
                  'v', ms=12.5, label='maximum Sharpe ratio')
         plt.xlabel('expected volatility')
         plt.ylabel('expected return')
         plt.legend();
```

[![1](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/1.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO9-1)

Minimizes the expected portfolio volatility

[![2](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/2.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO9-2)

Defines the Sharpe ratio function, assuming a short rate of `0`

[![3](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/3.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO9-3)

Maximizes the Sharpe ratio by minimizing its negative value

<figure><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/aiif_0303.png" alt="aiif 0303" height="1492" width="2545"><figcaption></figcaption></figure>

**Figure 3-3. Minimum volatility and maximum Sharpe ratio portfolios**

#### Efficient frontier

An _efficient portfolio_ is one that has a maximum expected return (risk) given its expected risk (return). In [Figure 3-3](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#figure\_nf\_03), all those portfolios that have a lower expected return than the minimum risk portfolio are _inefficient_. The following code derives the efficient portfolios in risk-return space and plots them as seen in [Figure 3-4](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#figure\_nf\_04). The set of all efficient portfolios is called the _efficient frontier_, and agents will only choose a portfolio that lies on the efficient frontier:

```
In [69]: cons = [{'type': 'eq', 'fun': lambda phi: np.sum(phi) - 1},
                {'type': 'eq', 'fun': lambda phi: mu_phi(phi) - target}]  

In [70]: bnds = ((0, 1), (0, 1))

In [71]: targets = np.linspace(mu_phi(min_var['x']), 0.16)  

In [72]: frontier = []
         for target in targets:
             phi_eff = minimize(sigma_phi, (0.5, 0.5),
                                constraints=cons, bounds=bnds)['x']  
             frontier.append((sigma_phi(phi_eff), mu_phi(phi_eff)))
         frontier = np.array(frontier)

In [73]: plt.figure(figsize=(10, 6))
         plt.plot(frontier[:, 0], frontier[:, 1], 'mo', ms=5,
                  label='efficient frontier')
         plt.plot(sigma_phi(min_var['x']), mu_phi(min_var['x']),
                  '^', ms=12.5, label='minimum volatility')
         plt.plot(sigma_phi(max_sharpe['x']), mu_phi(max_sharpe['x']),
                  'v', ms=12.5, label='maximum Sharpe ratio')
         plt.xlabel('expected volatility')
         plt.ylabel('expected return')
         plt.legend();
```

[![1](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/1.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO10-1)

The new constraint fixes a target level for the expected return.

[![2](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/2.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO10-2)

Generates the set of target expected returns.

[![3](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/3.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO10-3)

Derives the minimum volatility portfolio given a target expected return.

<figure><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/aiif_0304.png" alt="aiif 0304" height="1492" width="2510"><figcaption></figcaption></figure>

**Figure 3-4. Efficient frontier**

## Capital Asset Pricing Model

The capital asset pricing model (CAPM) is one of the most widely documented and applied models in finance. At its core, it relates in linear fashion the expected return for a single stock to the expected return of the market portfolio, usually approximated by a broad stock index such as the S\&P 500. The model dates back to the pioneering work of Sharpe (1964) and Lintner (1965). Jones (2012, ch. 9) describes the CAPM in relation to MVP as follows:

> Capital market theory is a positive theory in that it hypothesizes how investors do behave rather than how investors should behave, as in the case of modern portfolio theory (MVP). It is reasonable to view capital market theory as an extension of portfolio theory, but it is important to understand that MVP is not based on the validity, or lack thereof, of capital market theory.
>
> The specific equilibrium model of interest to many investors is known as the capital asset pricing model, typically referred to as the CAPM. It allows us to assess the relevant risk of an individual security as well as to assess the relationship between risk and the returns expected from investing. The CAPM is attractive as an equilibrium model because of its simplicity and its implications.

### Assumptions and Results

Assume the static model economy from the previous section ℳ�=({�,ℱ,�},𝔸) with � traded assets and all simplifying assumptions. In the CAPM, agents are assumed to invest according to MVP, caring only about the risk and return statistics of risky assets over one period.

In a _capital market equilibrium_, all available assets are held by all agents and the markets clear. Since agents are assumed to be identical in that they use MVP to form their efficient portfolios, this implies that all agents must hold the same efficient portfolio (in terms of composition) since the set of tradable assets is the same for every agent. In other words, the _market portfolio_ (set of tradable assets) must lie on the efficient frontier. If this were not the case, the market could not be in equilibrium.

What is the mechanism to obtain a capital market equilibrium? Today’s prices of the tradable assets are the mechanism to make sure that markets clear. If agents do not demand enough of a tradable asset, its price needs to decrease. If demand is higher than supply, its price needs to increase. If prices are set correctly, demand and supply are equal for every tradable asset. While MVP takes the prices of tradable assets as given, the CAPM is a theory and model about what the equilibrium price of an asset _should be_, given its risk-return characteristics.

The CAPM assumes the existence of (at least) one risk-free asset in which every agent can invest any amount and which earns the risk-free rate of �¯. Every agent will therefore hold a combination of the market portfolio and the risk-free asset in equilibrium, something known as the _two fund separation theorem_.[9](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#idm46320006314200) The set of all such portfolios is called the _capital market line_ (CML). [Figure 3-5](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#figure\_nf\_05) shows the CML schematically. Portfolios to the right of the market portfolio are only achievable if agents are allowed to sell the risk-free asset short and to borrow money that way:

```
In [74]: plt.figure(figsize=(10, 6))
         plt.plot((0, 0.3), (0.01, 0.22), label='capital market line')
         plt.plot(0, 0.01, 'o', ms=9, label='risk-less asset')
         plt.plot(0.2, 0.15, '^', ms=9, label='market portfolio')
         plt.annotate('$(0, \\bar{r})$', (0, 0.01), (-0.01, 0.02))
         plt.annotate('$(\sigma_M, \mu_M)$', (0.2, 0.15), (0.19, 0.16))
         plt.xlabel('expected volatility')
         plt.ylabel('expected return')
         plt.legend();
```

<figure><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/aiif_0305.png" alt="aiif 0305" height="1492" width="2510"><figcaption></figcaption></figure>

**Figure 3-5. Capital market line (CML)**

If ��,�� are the expected volatility and return of the market portfolio, the capital market line relating the expected portfolio return � to the expected volatility � is defined by the following:

�=�¯+��-�¯���

The following expression is called the _market price of risk_:

��-�¯��

It expresses how much more expected return in equilibrium is needed for an agent to bear one unit more of risk.

The CAPM then relates the expected return of any tradable risky asset �=1,2,...,� to the expected return of the market portfolio as follows:

��=�¯+��(��-�¯)

Here, �� is defined by the covariance of the market portfolio with the risky asset � divided by the variance of the market portfolio itself:

��=��,���2

When ��=0, the expected return according to the CAPM formula is the risk-free rate. The higher �� is, the higher the expected return for the risky asset will be. �� measures _risk that is nondiversifiable_. This type of risk is also called _market risk_ or _systemic risk_. According to the CAPM, this is the only risk for which an agent should be rewarded with a higher expected return.

### Numerical Example

Assume the static model economy with three possible future states from before ℳ3=({�,ℱ,�},𝔸) with the opportunity to borrow and lend at a risk-free rate of �¯= 0.0025. The two risky assets �,� are available in quantities of 0.8 and 0.2, respectively.

#### Capital market line

[Figure 3-6](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#figure\_nf\_06) shows the efficient frontier, the market portfolio, the risk-less asset, and the resulting capital market line in risk-return space:

```
In [75]: phi_M = np.array((0.8, 0.2))

In [76]: mu_M = mu_phi(phi_M)
         mu_M
Out[76]: 0.10666666666666666

In [77]: sigma_M = sigma_phi(phi_M)
         sigma_M
Out[77]: 0.39474323581566567

In [78]: r = 0.0025

In [79]: plt.figure(figsize=(10, 6))
         plt.plot(frontier[:, 0], frontier[:, 1], 'm.', ms=5,
                  label='efficient frontier')
         plt.plot(0, r, 'o', ms=9, label='risk-less asset')
         plt.plot(sigma_M, mu_M, '^', ms=9, label='market portfolio')
         plt.plot((0, 0.6), (r, r + ((mu_M - r) / sigma_M) * 0.6),
                  'r', label='capital market line', lw=2.0)
         plt.annotate('$(0, \\bar{r})$', (0, r), (-0.015, r + 0.01))
         plt.annotate('$(\sigma_M, \mu_M)$', (sigma_M, mu_M),
                      (sigma_M - 0.025, mu_M + 0.01))
         plt.xlabel('expected volatility')
         plt.ylabel('expected return')
         plt.legend();
```

<figure><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/aiif_0306.png" alt="aiif 0306" height="1492" width="2510"><figcaption></figcaption></figure>

**Figure 3-6. Capital market line with two risky assets**

#### Optimal portfolio

Assume an agent with an expected utility function defined over future payoffs as follows:

�:𝕏→ℝ+,�↦𝐄�(�(�))=𝐄��-�2�2

Here, �>0. After some transformations, the expected utility function can then be expressed over risk-return combinations:

�:ℝ+×ℝ+→ℝ,(�,�)↦�-�2(�2+�2)

## SPECIFIC QUADRATIC UTILITY FUNCTION

Although the MVP theory and the CAPM both assume that investors only care about one period portfolio risk and return, this assumption is in general only consistent with the EUT when a specific form of the Bernoulli utility function is given: the quadratic utility. This type of Bernoulli function is almost exclusively mentioned and used in the context of MVP theory. Beyond that, its particular form and characteristics are usually considered inappropriate. Neither the assumption of normally distributed asset returns nor the quadratic utility function seems to be an “elegant” way of reconciling the inconsistency between EUT on the one hand and MVP theory and the CAPM on the other hand.

What portfolio combination would the agent choose on the CML? A straightforward utility maximization, implemented in Python, yields the answer. To this end, fix the parameter �=1:

```
In [80]: def U(p):
             mu, sigma = p
             return mu - 1 / 2 * (sigma ** 2 + mu ** 2)  

In [81]: cons = {'type': 'eq',
                 'fun': lambda p: p[0] - (r + (mu_M - r) / sigma_M * p[1])}  

In [82]: opt = minimize(lambda p: -U(p), (0.1, 0.3), constraints=cons)

In [83]: opt
Out[83]:      fun: -0.034885186826739426
              jac: array([-0.93256102,  0.24608851])
          message: 'Optimization terminated successfully.'
             nfev: 8
              nit: 2
             njev: 2
           status: 0
          success: True
                x: array([0.06743897, 0.2460885 ])
```

[![1](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/1.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO11-1)

The utility function in risk-return space

[![2](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/2.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO11-2)

The condition that the portfolio be on the CML

#### Indifference curves

A visual analysis can illustrate the optimal decision making of the agent. Fixing a utility level for the agent, one can plot _indifference curves_ in risk-return space. An optimal portfolio is found when an indifference curve is tangent to the CML. Any other indifference curve (not touching the CML or cutting the CML twice) cannot identify an optimal portfolio.

First, here is some symbolic Python code that transforms the utility function in risk-return space into a functional relationship between � and � for a fixed utility level � and a fixed parameter value �. [Figure 3-7](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#figure\_nf\_07) shows two indifference curves. Every (�,�) combination on such an indifference curve yields the same utility; the agent is indifferent between such portfolios:

```
In [84]: from sympy import *
         init_printing(use_unicode=False, use_latex=False)

In [85]: mu, sigma, b, v = symbols('mu sigma b v')  

In [86]: sol = solve('mu - b / 2 * (sigma ** 2 + mu ** 2) - v', mu)  

In [87]: sol  
Out[87]:         _________________________     _________________________
                /    2      2                 /    2      2
          1 - \/  - b *sigma  - 2*b*v + 1   \/  - b *sigma  - 2*b*v + 1  + 1
         [--------------------------------, --------------------------------]
                         b                                 b

In [88]: u1 = sol[0].subs({'b': 1, 'v': 0.1})  
         u1
Out[88]:        ______________
               /            2
         1 - \/  0.8 - sigma

In [89]: u2 = sol[0].subs({'b': 1, 'v': 0.125})  
         u2
Out[89]:        _______________
               /             2
         1 - \/  0.75 - sigma

In [90]: f1 = lambdify(sigma, u1)  
         f2 = lambdify(sigma, u2)  

In [91]: sigma_ = np.linspace(0.0, 0.5)  
         u1_ = f1(sigma_)  
         u2_ = f2(sigma_)  

In [92]: plt.figure(figsize=(10, 6))
         plt.plot(sigma_, u1_, label='$v=0.1$')
         plt.plot(sigma_, u2_, '--', label='$v=0.125$')
         plt.xlabel('expected volatility')
         plt.ylabel('expected return')
         plt.legend();
```

[![1](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/1.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO12-1)

Defines `SymPy` symbols

[![2](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/2.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO12-2)

Solves the utility function for �

[![3](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/3.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO12-4)

Substitutes numerical values for �,�

[![4](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/4.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO12-6)

Generates callable functions from the resulting equations

[![5](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/5.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO12-8)

Specifies values for � over which to evaluate the functions

[![6](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/6.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO12-9)

Evaluates the callable functions for the two different utility levels

<figure><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/aiif_0307.png" alt="aiif 0307" height="1493" width="2537"><figcaption></figcaption></figure>

**Figure 3-7. Indifference curves in risk-return space**

In a next step, the indifference curves need to be combined with the CML to find out visually what the optimal portfolio choice of the agent is. Making use of the previous numerical optimization results, [Figure 3-8](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#figure\_nf\_08) shows the optimal portfolio—the point at which the indifference curve is tangent to the CML. [Figure 3-8](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#figure\_nf\_08) shows that the agent indeed chooses a mixture of the market portfolio and the risk-less asset:

```
In [93]: u = sol[0].subs({'b': 1, 'v': -opt['fun']})  
         u
Out[93]:        ____________________________
               /                          2
         1 - \/  0.930229626346521 - sigma

In [94]: f = lambdify(sigma, u)

In [95]: u_ = f(sigma_)  

In [96]: plt.figure(figsize=(10, 6))
         plt.plot(0, r, 'o', ms=9, label='risk-less asset')
         plt.plot(sigma_M, mu_M, '^', ms=9, label='market portfolio')
         plt.plot(opt['x'][1], opt['x'][0], 'v', ms=9, label='optimal portfolio')
         plt.plot((0, 0.5), (r, r + (mu_M - r) / sigma_M * 0.5),
                  label='capital market line', lw=2.0)
         plt.plot(sigma_, u_, '--', label='$v={}$'.format(-round(opt['fun'], 3)))
         plt.xlabel('expected volatility')
         plt.ylabel('expected return')
         plt.legend();
```

[![1](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/1.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO13-1)

Defines the indifference curve for the optimal utility level

[![2](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/2.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO13-2)

Derives numerical values to plot the indifference curve

<figure><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/aiif_0308.png" alt="aiif 0308" height="1492" width="2537"><figcaption></figcaption></figure>

**Figure 3-8. Optimal portfolio on the CML**

The topics presented in this sub-section are usually discussed under _capital market theory_ (CMT). The CAPM is part of that theory and shall be illustrated by the use of real financial time series data in the next chapter.

## Arbitrage Pricing Theory

Early on, shortcomings of the CAPM were observed and then addressed in the finance literature. One of the major generalizations of the CAPM is the arbitrage pricing theory (APT) as proposed in Ross (1971) and Ross (1976). Ross (1976) introduces his paper as follows:

> The purpose of this paper is to examine rigorously the arbitrage model of capital asset pricing developed in Ross (1971). The arbitrage model was proposed as an alternative to the mean variance capital asset pricing model, introduced by Sharpe, Lintner, and Treynor, that has become the major analytic tool for explaining phenomena observed in capital markets for risky assets.

### Assumptions and Results

The APT is a generalization of the CAPM to multiple risk factors. In that sense, APT does not assume that the market portfolio is the only relevant risk factor; there are rather multiple types of risk that together are assumed to drive the performance (expected returns) of a stock. Such risk factors might include size, volatility, value, and momentum.[10](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#idm46320004209384) Beyond this major difference, the model relies on similar assumptions, such as that markets are perfect, that (unlimited) borrowing and lending are possible at the same constant rate, and so on.

In its original dynamic version, as found in Ross (1976), the APT takes on the following form:

��=�+���+��

Here, �� is the vector of � observed variables—say, the expected returns of � different stocks—at time �:

��=��1��2⋮���

� is the vector of � constant terms:

�=�1�2⋮��

�� is the vector of � factors at time �:

��=��1��2⋮���

� is the �×� matrix of the so-called factor loadings:

�=�11�12...�1��21�22...�2�⋮⋮⋱⋮��1��2...���

Finally, �� is the vector of � sufficiently independent residual terms:

��=��1��2⋮���

Jones (2012, ch. 9) describes the difference between the CAPM and the APT as follows:

> Similar to the CAPM, or any other asset pricing model, APT posits a relationship between expected return and risk. It does so, however, using different assumptions and procedures. Very importantly, APT is not critically dependent on an underlying market portfolio as is the CAPM, which predicts that only market risk influences expected returns. Instead, APT recognizes that several types of risk may affect security returns.

Both the CAPM and the APT relate the output variables with the relevant input factors in _linear_ fashion. From an econometric point of view, both models are implemented based on linear ordinary least-squares (OLS) regression. While the CAPM can be implemented based on _univariate_ linear OLS regression, the APT requires _multivariate_ OLS regression.

### Numerical Example

The following numerical example casts the APT in a static model, although the formulation given previously is a dynamic one. Assume the static model economy with three possible future states from the previous section, ℳ3=({�,ℱ,�},𝔸). Assume that the two risky assets are now the relevant risk factors in the economy and introduce a third asset � with the following future payoff:

�1=12157

Although two linearly independent vectors, such as �1,�1, cannot form a basis of ℝ3, they can nevertheless be used for an OLS regression to approximate the payoff �1. The following Python code implements the OLS regression:

```
In [97]: M1
Out[97]: array([[20,  1],
                [10, 12],
                [ 5, 13]])

In [98]: M0
Out[98]: array([10, 10])

In [99]: V1 = np.array((12, 15, 7))

In [100]: reg = np.linalg.lstsq(M1, V1, rcond=-1)[0]  
          reg  
Out[100]: array([0.6141665 , 0.50030531])

In [101]: np.dot(M1, reg)
Out[101]: array([12.78363525, 12.14532872,  9.57480155])

In [102]: np.dot(M1, reg) - V1  
Out[102]: array([ 0.78363525, -2.85467128,  2.57480155])

In [103]: V0 = np.dot(M0, reg)  
          V0  
Out[103]: 11.144718094850402
```

[![1](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/1.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO14-1)

The optimal regression parameters can be interpreted as factor loadings.

[![2](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/2.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO14-3)

The two factors are not enough to explain the payoff �1; the replication is imperfect, and the residual values are nonzero.

[![3](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/3.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO14-4)

The factor loadings can be used to estimate an arbitrage-free price �0 for the risky asset �.

Obviously, the two factors are not enough to fully “explain” the payoff �1. This is not too surprising given standard results from linear algebra.[11](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#idm46320003577592) What about adding a third risk factor � to the model economy? Assume that the third risk factor � is defined by �0=10 and the following:

�1=12511

Now, the three risk factors together can explain (replicate) the payoff �1 fully (exactly):

```
In [104]: U0 = 10
          U1 = np.array((12, 5, 11))

In [105]: M0_ = np.array((S0, T0, U0))  

In [106]: M1_ = np.concatenate((M1.T, np.array([U1,]))).T  

In [107]: M1_  
Out[107]: array([[20,  1, 12],
                 [10, 12,  5],
                 [ 5, 13, 11]])

In [108]: np.linalg.matrix_rank(M1_)  
Out[108]: 3

In [109]: reg = np.linalg.lstsq(M1_, V1, rcond=-1)[0]
          reg
Out[109]: array([ 0.9575179 ,  0.72553699, -0.65632458])

In [110]: np.allclose(np.dot(M1_, reg), V1)  
Out[110]: True

In [111]: V0_ = np.dot(M0_, reg)
          V0_  
Out[111]: 10.267303102625307
```

[![1](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/1.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO15-1)

Augmented market price vector.

[![2](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/2.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO15-2)

Augmented market payoff matrix with full rank.

[![3](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/3.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO15-5)

Exact replication of �1. Residual values are zero.

[![4](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055426/files/assets/4.png)](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#co\_normative\_finance\_CO15-6)

Unique arbitrage-free price for the risky asset �.

The example here resembles the one presented in [“Uncertainty and Risk”](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#uncertainty\_risk) in that enough risk factors (tradable assets) can be used to derive an arbitrage-free price for a traded asset. APT does not necessarily require that perfect replication is possible; its very model formulation contains residual values. However, if perfect replication is possible, then the residual terms are zero, as in the previous example with three risk factors.

## Conclusions

Some of the early theories and models from the 1940s through the 1970s, in particular those presented in this chapter, are still central topics of finance textbooks and are still used in financial practice. One reason for this is that many of those mostly normative theories and models have a strong intellectual appeal to students, academics, and practitioners alike. They somehow “simply seem to make sense.” Using Python, numerical examples for the models presented are easily created, analyzed, and visualized.

Despite theories and models such as MVP and CAPM being intellectually appealing, easy to implement, and mathematically elegant, it is surprising that they are still so popular today, for a few reasons. First, the popular theories and models presented in this chapter have hardly any meaningful empirical support. Second, some of the theories and models are even theoretically inconsistent with each other in a number of ways. Third, there has been continuous progress on the theoretical and modeling fronts of finance, such that alternative theories and models are available. Fourth, modern computational and empirical finance can rely on almost unlimited data sources and almost unlimited computational power, making concise, parsimonious, and elegant mathematical models and results less and less relevant.

The next chapter analyzes some of the theories and models introduced in this chapter on the basis of real financial data. While in the early years of quantitative finance, data was a scarce resource, today even students have access to a wealth of financial data and open source tools that allow the comprehensive analysis of financial theories and models based on real-world data. Empirical finance has always been an important sister discipline to theoretical finance. However, financial theory has usually driven empirical finance to a large extent. The new area of _data-driven finance_ might lead to a lasting shift in the relative importance of theory as compared to data in finance.

## References

Books and papers cited in this chapter:

* Bender, Jennifer et al. 2013. “Foundations of Factor Investing.” _MSCI Research Insight_. [_http://bit.ly/aiif\_factor\_invest_](http://bit.ly/aiif\_factor\_invest).
* Calvello, Angelo. 2020. “Fund Managers Must Embrace AI Disruption.” _Financial Times_, January 15, 2020. [_http://bit.ly/aiif\_ai\_disrupt_](http://bit.ly/aiif\_ai\_disrupt).
* Eichberger, Jürgen, and Ian R. Harper. 1997. _Financial Economics._ New York: Oxford University Press.
* Fishburn, Peter. 1968. “Utility Theory.” _Management Science_ 14 (5): 335-378.
* Fama, Eugene F. and Kenneth R. French. 2004. “The Capital Asset Pricing Model: Theory and Evidence.” _Journal of Economic Perspectives_ 18 (3): 25-46.
* Halevy, Alon, Peter Norvig, and Fernando Pereira. 2009. “The Unreasonable Effectiveness of Data.” _IEEE Intelligent Systems_, Expert Opinion.
* Hilpisch, Yves. 2015. _Derivatives Analytics with Python: Data Analysis, Models, Simulation, Calibration, and Hedging_. Wiley Finance.
* Jacod, Jean, and Philip Protter. 2004. _Probability Essentials._ 2nd ed. Berlin: Springer.
* Johnstone, David and Dennis Lindley. 2013. “Mean-Variance and Expected Utility: The Borch Paradox.” _Statistical Science_ 28 (2): 223-237.
* Jones, Charles P. 2012. _Investments: Analysis and Management._ 12th ed. Hoboken: John Wiley & Sons.
* Karni, Edi. 2014. “Axiomatic Foundations of Expected Utility and Subjective Probability.” In _Handbook of the Economics of Risk and Uncertainty_, edited by Mark J. Machina and W. Kip Viscusi, 1-39. Oxford: North Holland.
* Lintner, John. 1965. “The Valuation of Risk Assets and the Selection of Risky Investments in Stock Portfolios and Capital Budgets.” _Review of Economics and Statistics_ 47 (1): 13-37.
* Markowitz, Harry. 1952. “Portfolio Selection.” _Journal of Finance_ 7 (1): 77-91.
* Pratt, John W. 1964. “Risk Aversion in the Small and in the Large.” _Econometrica_ 32 (1/2): 122-136.
* Ross, Stephen A. 1971. “Portfolio and Capital Market Theory with Arbitrary Preferences and Distributions: The General Validity of the Mean-Variance Approach in Large Markets.” Working Paper No. 12-72, Rodney L. White Center for Financial Research.
* ⸻. 1976. “The Arbitrage Theory of Capital Asset Pricing.” _Journal of Economic Theory_ 13: 341-360.
* Rubinstein, Mark. 2006. _A History of the Theory of Investments—My Annotated Bibliography._ Hoboken: Wiley Finance.
* Sharpe, William F. 1964. “Capital Asset Prices: A Theory of Market Equilibrium under Conditions of Risk.” _Journal of Finance_ 19 (3): 425-442.
* ⸻. 1966. “Mutual Fund Performance.” _Journal of Business_ 39 (1): 119-138.
* Varian, Hal R. 2010. _Intermediate Microeconomics: A Modern Approach._ 8th ed. New York & London: W.W. Norton & Company.
* von Neumann, John, and Oskar Morgenstern. 1944. _Theory of Games and Economic Behavior_. Princeton: Princeton University Press.

[1](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#idm46320010302616-marker) See Jacod and Protter (2004) for an introductory text on probability theory.

[2](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#idm46320010293832-marker) In a _dynamic_ economy, uncertainty would gradually resolve over time, say, on each day between today and one year later.

[3](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#idm46320010543544-marker) For details with regard to risk-neutral valuation and valuation by arbitrage, refer to Hilpisch (2015, ch. 4).

[4](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#idm46320009535112-marker) Again, refer to Hilpisch (2015, ch. 4) and the references given there.

[5](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#idm46320009425448-marker) For more background and details, see Eichberger and Harper (1997, ch. 1) or Varian (2010, ch. 12).

[6](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#idm46320009276408-marker) One speaks in general of _ordinal_ numbers. House numbers in streets are a good example for ordinal numbers.

[7](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#idm46320008384616-marker) For details, see [_http://bit.ly/aiif\_minimize_](http://bit.ly/aiif\_minimize).

[8](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#idm46320008324824-marker) These assumptions are not really necessary. Short sales, for instance, might be allowed without altering the analysis significantly.

[9](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#idm46320006314200-marker) For further details, see Jones (2012, ch. 9).

[10](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#idm46320004209384-marker) See Bender et al. (2013) for more background information about factors used in practice.

[11](https://learning.oreilly.com/library/view/artificial-intelligence-in/9781492055426/ch03.html#idm46320003577592-marker) Of course, the payoff  might lie (incidentally) in the span of the two factor payoff vectors �1,�1.
